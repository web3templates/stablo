"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = Navbar;

var _classnames = _interopRequireDefault(require("classnames"));

var _react = _interopRequireWildcard(require("react"));

var _configSanity = _interopRequireDefault(require("config:sanity"));

var _composeIcon = _interopRequireDefault(require("part:@sanity/base/compose-icon"));

var _hamburgerIcon = _interopRequireDefault(require("part:@sanity/base/hamburger-icon"));

var _router = require("@sanity/base/router");

var _searchIcon = _interopRequireDefault(require("part:@sanity/base/search-icon"));

var _default = _interopRequireDefault(require("part:@sanity/components/buttons/default"));

var sidecar = _interopRequireWildcard(require("part:@sanity/default-layout/sidecar?"));

var _toolSwitcher = _interopRequireDefault(require("part:@sanity/default-layout/tool-switcher"));

var _components = require("@sanity/base/components");

var _hooks = require("@sanity/base/hooks");

var _ui = require("@sanity/ui");

var _components2 = require("../components");

var _spaces = require("../util/spaces");

var _Branding = _interopRequireDefault(require("./branding/Branding"));

var _LoginStatus = _interopRequireDefault(require("./loginStatus/LoginStatus"));

var _SanityStatusContainer = _interopRequireDefault(require("./studioStatus/SanityStatusContainer"));

var _presenceMenu = require("./presenceMenu");

var _SearchContainer = _interopRequireDefault(require("./search/SearchContainer"));

var _Navbar = _interopRequireDefault(require("./Navbar.css"));

function _getRequireWildcardCache(nodeInterop) { if (typeof WeakMap !== "function") return null; var cacheBabelInterop = new WeakMap(); var cacheNodeInterop = new WeakMap(); return (_getRequireWildcardCache = function _getRequireWildcardCache(nodeInterop) { return nodeInterop ? cacheNodeInterop : cacheBabelInterop; })(nodeInterop); }

function _interopRequireWildcard(obj, nodeInterop) { if (!nodeInterop && obj && obj.__esModule) { return obj; } if (obj === null || typeof obj !== "object" && typeof obj !== "function") { return { default: obj }; } var cache = _getRequireWildcardCache(nodeInterop); if (cache && cache.has(obj)) { return cache.get(obj); } var newObj = {}; var hasPropertyDescriptor = Object.defineProperty && Object.getOwnPropertyDescriptor; for (var key in obj) { if (key !== "default" && Object.prototype.hasOwnProperty.call(obj, key)) { var desc = hasPropertyDescriptor ? Object.getOwnPropertyDescriptor(obj, key) : null; if (desc && (desc.get || desc.set)) { Object.defineProperty(newObj, key, desc); } else { newObj[key] = obj[key]; } } } newObj.default = obj; if (cache) { cache.set(obj, newObj); } return newObj; }

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

// @todo: remove the following line when part imports has been removed from this file
///<reference types="@sanity/types/parts" />
// eslint-disable-next-line camelcase
// eslint-disable-next-line complexity
function Navbar(props) {
  var _router$state;

  var createMenuIsOpen = props.createMenuIsOpen,
      onCreateButtonClick = props.onCreateButtonClick,
      onToggleMenu = props.onToggleMenu,
      onSwitchTool = props.onSwitchTool,
      onUserLogout = props.onUserLogout,
      onSearchOpen = props.onSearchOpen,
      onSearchClose = props.onSearchClose,
      onSetLoginStatusElement = props.onSetLoginStatusElement,
      onSetSearchElement = props.onSetSearchElement,
      router = props.router,
      tools = props.tools,
      searchIsOpen = props.searchIsOpen,
      documentTypes = props.documentTypes,
      showLabel = props.showLabel,
      showToolMenu = props.showToolMenu;
  var rootState = _spaces.HAS_SPACES && router.state.space ? {
    space: router.state.space
  } : {};
  var className = (0, _classnames.default)(_Navbar.default.root, showToolMenu && _Navbar.default.withToolMenu);
  var searchClassName = (0, _classnames.default)(_Navbar.default.search, searchIsOpen && _Navbar.default.searchIsOpen);
  var tool = ((_router$state = router.state) === null || _router$state === void 0 ? void 0 : _router$state.tool) || '';

  var _useCurrentUser = (0, _hooks.useCurrentUser)(),
      currentUser = _useCurrentUser.value;

  var createAnyPermission = (0, _hooks.unstable_useCanCreateAnyOf)(documentTypes);
  return /*#__PURE__*/_react.default.createElement(_ui.Card, {
    className: className,
    "data-search-open": searchIsOpen,
    scheme: "dark"
  }, /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.hamburger
  }, /*#__PURE__*/_react.default.createElement(_default.default, {
    "aria-label": "Open menu",
    icon: _hamburgerIcon.default,
    kind: "simple",
    onClick: onToggleMenu,
    padding: "small",
    title: "Open menu",
    tone: "navbar"
  })), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.branding
  }, /*#__PURE__*/_react.default.createElement(_router.StateLink, {
    state: rootState,
    className: _Navbar.default.brandingLink
  }, /*#__PURE__*/_react.default.createElement(_Branding.default, {
    projectName: _configSanity.default && _configSanity.default.project.name
  }))), _spaces.HAS_SPACES && /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.datasetSelect
  }, /*#__PURE__*/_react.default.createElement(_components2.DatasetSelect, {
    isVisible: showToolMenu,
    tone: "navbar"
  })), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.createButton
  }, /*#__PURE__*/_react.default.createElement(_components.LegacyLayerProvider, {
    zOffset: "navbarPopover"
  }, /*#__PURE__*/_react.default.createElement(_ui.Tooltip, {
    content: createAnyPermission.granted ? /*#__PURE__*/_react.default.createElement("span", {
      className: _Navbar.default.createButtonTooltipContent
    }, "Create new document") : /*#__PURE__*/_react.default.createElement(_ui.Card, {
      padding: 2,
      radius: 1
    }, /*#__PURE__*/_react.default.createElement(_components.InsufficientPermissionsMessage, {
      currentUser: currentUser,
      operationLabel: "create any document"
    }))
  }, /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_default.default, {
    "aria-label": "Create",
    "data-testid": "default-layout-global-create-button",
    icon: _composeIcon.default,
    kind: "simple",
    onClick: onCreateButtonClick,
    padding: "small",
    disabled: !createAnyPermission.granted,
    selected: createMenuIsOpen,
    tone: "navbar"
  }))))), /*#__PURE__*/_react.default.createElement("div", {
    className: searchClassName,
    ref: onSetSearchElement
  }, /*#__PURE__*/_react.default.createElement("div", null, /*#__PURE__*/_react.default.createElement(_SearchContainer.default, {
    shouldBeFocused: searchIsOpen,
    onOpen: onSearchOpen,
    onClose: onSearchClose
  }))), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.toolSwitcher
  }, tools.length > 1 && /*#__PURE__*/_react.default.createElement(_toolSwitcher.default, {
    direction: "horizontal",
    isVisible: showToolMenu,
    tools: tools,
    activeToolName: tool,
    onSwitchTool: onSwitchTool,
    router: router,
    showLabel: showLabel,
    tone: "navbar"
  })), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.extras
  }), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.sanityStatus
  }, /*#__PURE__*/_react.default.createElement(_SanityStatusContainer.default, null)), sidecar && sidecar.isSidecarEnabled && sidecar.isSidecarEnabled() && /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.helpButton
  }, sidecar && /*#__PURE__*/(0, _react.createElement)(sidecar.SidecarToggleButton)), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.presenceStatus
  }, /*#__PURE__*/_react.default.createElement(_presenceMenu.PresenceMenu, null)), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.loginStatus,
    ref: onSetLoginStatusElement
  }, /*#__PURE__*/_react.default.createElement(_LoginStatus.default, {
    onLogout: onUserLogout
  })), /*#__PURE__*/_react.default.createElement("div", {
    className: _Navbar.default.searchButton
  }, /*#__PURE__*/_react.default.createElement(_default.default, {
    icon: _searchIcon.default,
    kind: "simple",
    onClick: onSearchOpen,
    padding: "small",
    tone: "navbar"
  })));
}